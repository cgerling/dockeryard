#!/bin/bash

if [[ -z $REPOSITORY ]]; then
  echo "Variable REPOSITORY is required"
  exit 1
fi

if [[ -z $REGISTRY ]]; then
  echo "Variable REGISTRY is required"
  exit 1
fi

IFS=':' read -ra ARG_VALUES <<< "$1"

IMAGE=${ARG_VALUES[0]}
VERSION=${ARG_VALUES[1]}

BASE_PATH="$PWD/images/$IMAGE"

source "$BASE_PATH/meta.sh"
if [[ -z $VERSION ]]; then
  VERSION=$CURRENT_VERSION
fi

if [[ -z $VERSION ]]; then
  VERSION="latest"
fi

shift

TAG="$REGISTRY/$REPOSITORY/$IMAGE:$VERSION"
CMD_ARGS=$@

